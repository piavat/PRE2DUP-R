<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to PRE2DUP-R • PRE2DUPR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to PRE2DUP-R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PRE2DUPR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../tutorials/Instruction_to_build_package_parameter.html">Package Parameters</a></li>
    <li><a class="dropdown-item" href="../tutorials/introduction_to_ATC_parameter.html">ATC Parameters</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to PRE2DUP-R</h1>
            
      

      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<p>This vignette provides a brief introduction to the
<code>PRE2DUPR</code> package, which is designed to construct treatment
periods from drug purhchases data with PRE2DUP algorithm. The package
includes functions for validating data and running the PRE2DUP.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To install the <code>PRE2DUPR</code> package, you can use the
following command in R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"piavat/PRE2DUP-R"</span><span class="op">)</span></span></code></pre></div>
<p>To use the <code>PRE2DUPR</code> package, you can start by loading it
into your R session:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">PRE2DUPR</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>The <code>PRE2DUPR</code> package comes with example datasets that
you can use to test the functionality of the PRE2DUP algorithm. The
datasets include:</p>
<ul>
<li>
<code>purchases_example</code>: A dataset containing drug purchase
records.</li>
<li>
<code>hospitalizations_example</code>: A dataset containing hospital
admission records.</li>
<li>
<code>package_parameters_example</code>: A dataset containing
package characteristics.</li>
<li>
<code>ATC_parameters_example</code>: A dataset containing ATC code
characteristics.</li>
</ul>
<p>All data types have associated functions to validate the input before
running <code>pre2dup</code>. These functions are called internally by
the program, so you don’t need to run them manually unless you want to
check your data beforehand.</p>
<p>It is recommended to run these checks in advance to detect and
correct errors more easily and efficiently. Note that the internal
checks in <code>pre2dup</code> will display only the first five rows
with detected errors. When run separately, all rows with issues can be
listed by adjusting the function parameter
<code>print_all = TRUE</code>.</p>
</div>
<div class="section level2">
<h2 id="drug-purchases-data">Drug purchases data<a class="anchor" aria-label="anchor" href="#drug-purchases-data"></a>
</h2>
<p>Drug purchases are records with information about the purchase of
drugs, including the person who made the purchase, the drug’s ATC code,
the package ID, the date of purchase, the number of packages purchased,
and the amount in DDDs (Defined Daily Doses).</p>
<div class="section level3">
<h3 id="data-validation">Data validation<a class="anchor" aria-label="anchor" href="#data-validation"></a>
</h3>
<p>Function <code>check_purchases</code> checks the data before running
the PRE2DUP algorithm. It ensures that the dataset meets the necessary
requirements for the algorithm to function correctly.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">check_purchases</span>(<span class="at">dt =</span> purchases_example, </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>                <span class="at">pre_person_id =</span> <span class="st">"id"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                <span class="at">pre_atc =</span> <span class="st">"ATC"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                <span class="at">pre_package_id =</span> <span class="st">"vnr"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>                <span class="at">pre_date =</span> <span class="st">"purchase_date"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>                <span class="at">pre_ratio =</span> <span class="st">"n_packages"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                <span class="at">pre_ddd =</span> <span class="st">"amount"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>                <span class="at">print_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>                </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘purchases_example’</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="hospitalizations-data">Hospitalizations data<a class="anchor" aria-label="anchor" href="#hospitalizations-data"></a>
</h2>
<p>Hospitalizations are records of hospital admissions, including the
person ID, admission date, and discharge date. This data is used to
assess the impact of hospitalizations on drug exposure periods.</p>
<div class="section level3">
<h3 id="data-validation-1">Data validation<a class="anchor" aria-label="anchor" href="#data-validation-1"></a>
</h3>
<p>Function <code>check_hospitalizations</code> checks the data before
running the PRE2DUP algorithm.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">check_hospitalizations</span>(<span class="at">dt =</span> hospitalizations_example,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>                       <span class="at">hosp_person_id =</span> <span class="st">"id"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                       <span class="at">hosp_admission =</span> <span class="st">"hospital_start"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>                       <span class="at">hosp_discharge =</span> <span class="st">"hospital_end"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>                       <span class="at">print_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>                </span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘hospitalizations_example’</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="package-parameters">Package parameters<a class="anchor" aria-label="anchor" href="#package-parameters"></a>
</h2>
<p>Package parameters are used to define the characteristics of drug
packages. The parameter file specifies the identifying number, ATC code,
and the minimum, usual, and maximum duration of a package, as well as
the usual and minimum dose in defined daily doses (DDDs).</p>
<p>Intruction show to create package parameters <a href="../tutorials/Instruction_to_build_package_parameter.html">Package
Parameters tutorial</a>.</p>
<div class="section level3">
<h3 id="data-validation-2">Data validation<a class="anchor" aria-label="anchor" href="#data-validation-2"></a>
</h3>
<p>Function <code>check_package_parameters</code> checks the data before
running the PRE2DUP algorithm.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">check_package_parameters</span>(<span class="at">dt =</span> package_parameters_example, </span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>                         <span class="at">pack_atc =</span> <span class="st">"ATC"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>                         <span class="at">pack_id =</span> <span class="st">"vnr"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>                         <span class="at">pack_ddd_low =</span> <span class="st">"lower_ddd"</span>, </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>                         <span class="at">pack_ddd_usual =</span> <span class="st">"usual_ddd"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>                         <span class="at">pack_dur_min =</span> <span class="st">"minimum_dur"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>                         <span class="at">pack_dur_usual =</span> <span class="st">"usual_dur"</span>, </span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>                         <span class="at">pack_dur_max =</span> <span class="st">"maximum_dur"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>                         <span class="at">print_all =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>                </span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘package_parameters_example’</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="atc-parameters">ATC parameters<a class="anchor" aria-label="anchor" href="#atc-parameters"></a>
</h2>
<p>ATC parameters are used to define the characteristics of ATC codes
when package-specific information is not available. The ATC parameters
file specifies the partial or full ATC code, the lower limit of daily
dose, the usual daily dose, and the minimum and maximum allowed
treatment durations. Package example data ATC_parameters can be used as
such or as an example of how to create your own ATC code characteristics
dataset.</p>
<div class="section level3">
<h3 id="data-validation-3">Data validation<a class="anchor" aria-label="anchor" href="#data-validation-3"></a>
</h3>
<p>Function <code>check_atc_parameters</code> checks the ATC parameters
data before running the PRE2DUP algorithm.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">check_atc_parameters</span>(<span class="at">dt =</span> ATC_parameters,</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                     <span class="at">atc_class =</span> <span class="st">"partial_atc"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                     <span class="at">atc_ddd_low =</span> <span class="st">"lower_ddd_atc"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                     <span class="at">atc_ddd_usual =</span> <span class="st">"usual_ddd_atc"</span>, </span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>                     <span class="at">atc_dur_min =</span> <span class="st">"minimum_dur_atc"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                     <span class="at">atc_dur_max =</span> <span class="st">"maximum_dur_atc"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>                     <span class="at">print_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>                </span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘ATC_parameters’.</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="running-the-pre2dup">Running the PRE2DUP<a class="anchor" aria-label="anchor" href="#running-the-pre2dup"></a>
</h2>
<p>The PRE2DUP algorithm for creation of drug use periods is run using
the <code>pre2dup</code> function. This function will process your drug
purchase data, hospitalizations, package parameters, and ATC parameters
to estimate drug exposure.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">pre2dup</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="at">pre_data =</span> purchases_example,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="at">pre_person_id =</span> <span class="st">"id"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="at">pre_atc =</span> <span class="st">"ATC"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="at">pre_package_id =</span> <span class="st">"vnr"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="at">pre_date =</span> <span class="st">"purchase_date"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="at">pre_ratio =</span> <span class="st">"n_packages"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="at">pre_ddd =</span> <span class="st">"amount"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="at">package_parameters =</span> package_parameters_example,</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  <span class="at">pack_atc =</span> <span class="st">"ATC"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  <span class="at">pack_id =</span> <span class="st">"vnr"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  <span class="at">pack_ddd_low =</span> <span class="st">"lower_ddd"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  <span class="at">pack_ddd_usual =</span><span class="st">"usual_ddd"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  <span class="at">pack_dur_min =</span> <span class="st">"minimum_dur"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="at">pack_dur_usual =</span> <span class="st">"usual_dur"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="at">pack_dur_max =</span> <span class="st">"maximum_dur"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>  <span class="at">atc_parameters =</span> ATC_parameters,</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="at">atc_class =</span> <span class="st">"partial_atc"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>  <span class="at">atc_ddd_low =</span> <span class="st">"lower_ddd_atc"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>  <span class="at">atc_ddd_usual =</span> <span class="st">"usual_ddd_atc"</span>,</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>  <span class="at">atc_dur_min =</span> <span class="st">"minimum_dur_atc"</span>,</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>  <span class="at">atc_dur_max =</span> <span class="st">"maximum_dur_atc"</span>,</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>  <span class="at">hosp_data =</span> hospitalizations_example,</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>  <span class="at">hosp_person_id =</span> <span class="st">"id"</span>,</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>  <span class="at">hosp_admission =</span> <span class="st">"hospital_start"</span>,</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>  <span class="at">hosp_discharge =</span> <span class="st">"hospital_end"</span>,</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>  <span class="at">date_range =</span> <span class="fu">c</span>(<span class="st">"2025-01-01"</span>, <span class="st">"2025-12-31"</span>),</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>  <span class="at">global_gap_max =</span> <span class="dv">300</span>,</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>  <span class="at">global_min =</span> <span class="dv">5</span>,</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>  <span class="at">global_max =</span> <span class="dv">300</span>,</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>  <span class="at">global_max_single =</span> <span class="dv">150</span>,</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>  <span class="at">global_ddd_high =</span> <span class="dv">10</span>,</span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>  <span class="at">global_hosp_max =</span> <span class="dv">30</span>,</span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>  <span class="at">weight_past =</span> <span class="dv">1</span>,</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>  <span class="at">weight_current =</span> <span class="dv">4</span>,</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>  <span class="at">weight_next =</span> <span class="dv">1</span>,</span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>  <span class="at">weight_first_last =</span> <span class="dv">5</span>,</span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>  <span class="at">calculate_pack_dur_usual =</span> T,</span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a>  <span class="at">days_covered =</span> <span class="dv">5</span>,</span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a>  <span class="at">post_process_perc =</span> <span class="dv">1</span>)</span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a>  </span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a>Step <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Checking parameters and datasets...</span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘pre_data’</span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘package_parameters’</span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘atc_parameters’.</span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘hosp_data’</span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>Step <span class="dv">2</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Calculating purchase durations...</span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a>Step <span class="dv">3</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Stockpiling assessment...</span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a>Step <span class="dv">4</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Calculating common package durations <span class="cf">in</span> data...</span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a>Refill lengths couldn’t be re<span class="sc">-</span>estimated, probably due to too small data size.</span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a>Step <span class="dv">5</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Preparing drug use periods...</span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a>Step <span class="dv">6</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Post<span class="sc">-</span>processing drug use periods...</span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a>Current post processing percentage<span class="sc">:</span> <span class="dv">1</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a>Drug use periods calculated. <span class="dv">7</span> periods created <span class="cf">for</span> <span class="dv">5</span> persons.</span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a><span class="sc">$</span>periods</span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a>   period     id     ATC  dup_start    dup_end dup_days dup_hospital_days dup_n_purchases dup_last_purchase dup_total_DDD dup_temporal_average_DDDs</span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a>    <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>fctr<span class="sc">&gt;</span>  <span class="er">&lt;</span>char<span class="sc">&gt;</span>     <span class="er">&lt;</span>Date<span class="sc">&gt;</span>     <span class="er">&lt;</span>Date<span class="sc">&gt;</span>    <span class="er">&lt;</span>num<span class="sc">&gt;</span>             <span class="er">&lt;</span>num<span class="sc">&gt;</span>           <span class="er">&lt;</span>int<span class="sc">&gt;</span>            <span class="er">&lt;</span>Date<span class="sc">&gt;</span>         <span class="er">&lt;</span>num<span class="sc">&gt;</span>                     <span class="er">&lt;</span>num<span class="sc">&gt;</span></span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>      <span class="dv">1</span>      <span class="dv">1</span> N05AH02 <span class="dv">2025-01-01</span> <span class="dv">2025-04-14</span>      <span class="dv">104</span>                 <span class="dv">0</span>               <span class="dv">3</span>        <span class="dv">2025-03-08</span>         <span class="fl">99.99</span>                     <span class="fl">0.961</span></span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span>      <span class="dv">2</span>      <span class="dv">2</span> N05AH02 <span class="dv">2025-01-15</span> <span class="dv">2025-04-28</span>      <span class="dv">104</span>                 <span class="dv">5</span>               <span class="dv">3</span>        <span class="dv">2025-03-22</span>         <span class="fl">99.99</span>                     <span class="fl">0.961</span></span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span>      <span class="dv">3</span>      <span class="dv">3</span> N05AH02 <span class="dv">2025-02-01</span> <span class="dv">2025-05-15</span>      <span class="dv">104</span>                 <span class="dv">0</span>               <span class="dv">3</span>        <span class="dv">2025-04-08</span>         <span class="fl">99.99</span>                     <span class="fl">0.961</span></span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span>      <span class="dv">4</span>      <span class="dv">3</span> N05AH04 <span class="dv">2025-01-05</span> <span class="dv">2025-08-26</span>      <span class="dv">233</span>                 <span class="dv">0</span>               <span class="dv">2</span>        <span class="dv">2025-04-15</span>        <span class="fl">200.00</span>                     <span class="fl">0.858</span></span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>      <span class="dv">5</span>      <span class="dv">4</span> N05AH02 <span class="dv">2025-01-10</span> <span class="dv">2025-04-23</span>      <span class="dv">104</span>                 <span class="dv">0</span>               <span class="dv">3</span>        <span class="dv">2025-03-17</span>         <span class="fl">99.99</span>                     <span class="fl">0.961</span></span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span>      <span class="dv">6</span>      <span class="dv">4</span> N05AH04 <span class="dv">2025-01-20</span> <span class="dv">2025-09-10</span>      <span class="dv">233</span>                 <span class="dv">0</span>               <span class="dv">2</span>        <span class="dv">2025-04-30</span>        <span class="fl">200.00</span>                     <span class="fl">0.858</span></span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a><span class="dv">7</span><span class="sc">:</span>      <span class="dv">7</span>      <span class="dv">5</span> N05AH04 <span class="dv">2025-01-01</span> <span class="dv">2025-08-22</span>      <span class="dv">233</span>                <span class="dv">38</span>               <span class="dv">2</span>        <span class="dv">2025-04-11</span>        <span class="fl">200.00</span>                     <span class="fl">0.858</span></span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a><span class="sc">$</span>pack_info</span>
<span id="cb7-67"><a href="#cb7-67" tabindex="-1"></a><span class="cn">NULL</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow-when-using-estimated-usual-package-durations-from-data">Workflow when using estimated usual package durations from data<a class="anchor" aria-label="anchor" href="#workflow-when-using-estimated-usual-package-durations-from-data"></a>
</h2>
<p>The <code>pre2dup</code> function has an option to estimate the usual
package durations from the data. This is useful when you want to derive
package durations based on the actual purchase patterns in your dataset.
Set <code>calculate_pack_dur_usual = T</code>, run the program and
update package parameters based on common duration in data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Make data so big, that it can calculate common durations</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="dv">20</span>))</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>vnr <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">30627</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="dv">41738</span>, <span class="dv">10</span>)), <span class="dv">5</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>atc <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"N05AH02"</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="st">"N05AH04"</span>, <span class="dv">10</span>)), <span class="dv">5</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>d40 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-01-01"</span>)  <span class="sc">+</span> <span class="dv">40</span><span class="sc">*</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>d120 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>)  <span class="sc">+</span> <span class="dv">120</span><span class="sc">*</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(d40, d120), <span class="dv">5</span>)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>ddds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">33</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="dv">80</span>, <span class="dv">10</span>)), <span class="dv">5</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>ratio <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>purchases_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, vnr, atc, dates, ddds, ratio)</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co"># This example uses function default values, they can be changed to fit your needs.</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>outdata <span class="ot">&lt;-</span><span class="fu">pre2dup</span>(</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  <span class="at">pre_data =</span> purchases_data,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  <span class="at">pre_person_id =</span> <span class="st">"id"</span>,</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  <span class="at">pre_atc =</span> <span class="st">"atc"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  <span class="at">pre_package_id =</span> <span class="st">"vnr"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>  <span class="at">pre_date =</span> <span class="st">"dates"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="at">pre_ratio =</span> <span class="st">"ratio"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>  <span class="at">pre_ddd =</span> <span class="st">"ddds"</span>,</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>  <span class="at">package_parameters =</span> package_parameters_example,</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>  <span class="at">pack_atc =</span> <span class="st">"ATC"</span>,</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>  <span class="at">pack_id =</span> <span class="st">"vnr"</span>,</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>  <span class="at">pack_ddd_low =</span> <span class="st">"lower_ddd"</span>,</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>  <span class="at">pack_ddd_usual =</span><span class="st">"usual_ddd"</span>,</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>  <span class="at">pack_dur_min =</span> <span class="st">"minimum_dur"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>  <span class="at">pack_dur_usual =</span> <span class="st">"usual_dur"</span>,</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>  <span class="at">pack_dur_max =</span> <span class="st">"maximum_dur"</span>,</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>  <span class="at">atc_parameters =</span> ATC_parameters,</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>  <span class="at">atc_class =</span> <span class="st">"partial_atc"</span>,</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>  <span class="at">atc_ddd_low =</span> <span class="st">"lower_ddd_atc"</span>,</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>  <span class="at">atc_ddd_usual =</span> <span class="st">"usual_ddd_atc"</span>,</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>  <span class="at">atc_dur_min =</span> <span class="st">"minimum_dur_atc"</span>,</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>  <span class="at">atc_dur_max =</span> <span class="st">"maximum_dur_atc"</span>,</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>  <span class="at">calculate_pack_dur_usual =</span> T</span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>)</span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>  </span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>Step <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Checking parameters and datasets...</span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘pre_data’</span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘package_parameters’</span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘atc_parameters’.</span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>Step <span class="dv">2</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Calculating purchase durations...</span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>Step <span class="dv">3</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Stockpiling assessment...</span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>Step <span class="dv">4</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Calculating common package durations <span class="cf">in</span> data...</span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>Step <span class="dv">5</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Preparing drug use periods...</span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>Step <span class="dv">6</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Post<span class="sc">-</span>processing drug use periods...</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>Current post processing percentage<span class="sc">:</span> <span class="dv">1</span></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a>Drug use periods calculated. <span class="dv">10</span> periods created <span class="cf">for</span> <span class="dv">5</span> persons.</span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a><span class="co"># Save updated package parameters</span></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a>updated_params <span class="ot">&lt;-</span> outdata<span class="sc">$</span>pack_info</span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a><span class="co"># Check new common durations</span></span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a>updated_params[<span class="sc">!</span><span class="fu">is.na</span>(updated_params<span class="sc">$</span>common_duration), ]</span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a>    vnr     ATC product_name strength strength_num packagesize packsize_num drug_form_harmonized ddd_per_pack minimum_dur usual_dur maximum_dur lower_ddd usual_ddd common_duration usual_duration_new</span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a><span class="dv">6</span> <span class="dv">30627</span> N05AH02      LEPONEX    <span class="dv">100</span>MG          <span class="dv">100</span>         <span class="dv">100</span>          <span class="dv">100</span>               TABLET     <span class="fl">33.33333</span>          <span class="dv">25</span>     <span class="fl">33.33</span>         <span class="dv">100</span>    <span class="fl">0.3333</span>      <span class="fl">1.00</span>              <span class="dv">40</span>                 <span class="dv">40</span></span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a><span class="dv">8</span> <span class="dv">41738</span> N05AH04    KETIPINOR    <span class="dv">300</span>MG          <span class="dv">300</span>      <span class="dv">100</span>FOL          <span class="dv">100</span>               TABLET     <span class="fl">75.00000</span>          <span class="dv">50</span>    <span class="fl">100.00</span>         <span class="dv">200</span>    <span class="fl">0.3750</span>      <span class="fl">0.75</span>             <span class="dv">120</span>                <span class="dv">120</span></span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a><span class="co"># Make a new common duration column selecting the common duration from the updated package parameters by your choice</span></span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a>updated_params<span class="sc">$</span>usual_duration_new <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(updated_params2<span class="sc">$</span>common_duration),</span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a>  updated_params2<span class="sc">$</span>common_duration,</span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a>  updated_params2<span class="sc">$</span>usual_dur</span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a>)</span>
<span id="cb8-64"><a href="#cb8-64" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" tabindex="-1"></a><span class="co"># Run PRE2DUP with the updated package parameters</span></span>
<span id="cb8-66"><a href="#cb8-66" tabindex="-1"></a>outdata <span class="ot">&lt;-</span><span class="fu">pre2dup</span>(</span>
<span id="cb8-67"><a href="#cb8-67" tabindex="-1"></a>  <span class="at">pre_data =</span> purchases_data,</span>
<span id="cb8-68"><a href="#cb8-68" tabindex="-1"></a>  <span class="at">pre_person_id =</span> <span class="st">"id"</span>,</span>
<span id="cb8-69"><a href="#cb8-69" tabindex="-1"></a>  <span class="at">pre_atc =</span> <span class="st">"atc"</span>,</span>
<span id="cb8-70"><a href="#cb8-70" tabindex="-1"></a>  <span class="at">pre_package_id =</span> <span class="st">"vnr"</span>,</span>
<span id="cb8-71"><a href="#cb8-71" tabindex="-1"></a>  <span class="at">pre_date =</span> <span class="st">"dates"</span>,</span>
<span id="cb8-72"><a href="#cb8-72" tabindex="-1"></a>  <span class="at">pre_ratio =</span> <span class="st">"ratio"</span>,</span>
<span id="cb8-73"><a href="#cb8-73" tabindex="-1"></a>  <span class="at">pre_ddd =</span> <span class="st">"ddds"</span>,</span>
<span id="cb8-74"><a href="#cb8-74" tabindex="-1"></a>  <span class="at">package_parameters =</span> updated_params,</span>
<span id="cb8-75"><a href="#cb8-75" tabindex="-1"></a>  <span class="at">pack_atc =</span> <span class="st">"ATC"</span>,</span>
<span id="cb8-76"><a href="#cb8-76" tabindex="-1"></a>  <span class="at">pack_id =</span> <span class="st">"vnr"</span>,</span>
<span id="cb8-77"><a href="#cb8-77" tabindex="-1"></a>  <span class="at">pack_ddd_low =</span> <span class="st">"lower_ddd"</span>,</span>
<span id="cb8-78"><a href="#cb8-78" tabindex="-1"></a>  <span class="at">pack_ddd_usual =</span><span class="st">"usual_ddd"</span>,</span>
<span id="cb8-79"><a href="#cb8-79" tabindex="-1"></a>  <span class="at">pack_dur_min =</span> <span class="st">"minimum_dur"</span>,</span>
<span id="cb8-80"><a href="#cb8-80" tabindex="-1"></a>  <span class="at">pack_dur_usual =</span> <span class="st">"usual_duration_new"</span>, <span class="co"># This is the new column</span></span>
<span id="cb8-81"><a href="#cb8-81" tabindex="-1"></a>  <span class="at">pack_dur_max =</span> <span class="st">"maximum_dur"</span>,</span>
<span id="cb8-82"><a href="#cb8-82" tabindex="-1"></a>  <span class="at">atc_parameters =</span> ATC_parameters,</span>
<span id="cb8-83"><a href="#cb8-83" tabindex="-1"></a>  <span class="at">atc_class =</span> <span class="st">"partial_atc"</span>,</span>
<span id="cb8-84"><a href="#cb8-84" tabindex="-1"></a>  <span class="at">atc_ddd_low =</span> <span class="st">"lower_ddd_atc"</span>,</span>
<span id="cb8-85"><a href="#cb8-85" tabindex="-1"></a>  <span class="at">atc_ddd_usual =</span> <span class="st">"usual_ddd_atc"</span>,</span>
<span id="cb8-86"><a href="#cb8-86" tabindex="-1"></a>  <span class="at">atc_dur_min =</span> <span class="st">"minimum_dur_atc"</span>,</span>
<span id="cb8-87"><a href="#cb8-87" tabindex="-1"></a>  <span class="at">atc_dur_max =</span> <span class="st">"maximum_dur_atc"</span>,</span>
<span id="cb8-88"><a href="#cb8-88" tabindex="-1"></a>  <span class="at">calculate_pack_dur_usual =</span> F <span class="co"># Not needed anymore, as we have updated package parameters</span></span>
<span id="cb8-89"><a href="#cb8-89" tabindex="-1"></a>)</span>
<span id="cb8-90"><a href="#cb8-90" tabindex="-1"></a>Step <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Checking parameters and datasets...</span>
<span id="cb8-91"><a href="#cb8-91" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘pre_data’</span>
<span id="cb8-92"><a href="#cb8-92" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘package_parameters’</span>
<span id="cb8-93"><a href="#cb8-93" tabindex="-1"></a>Checks passed <span class="cf">for</span> ‘atc_parameters’.</span>
<span id="cb8-94"><a href="#cb8-94" tabindex="-1"></a>Step <span class="dv">2</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Calculating purchase durations...</span>
<span id="cb8-95"><a href="#cb8-95" tabindex="-1"></a>Step <span class="dv">3</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Stockpiling assessment...</span>
<span id="cb8-96"><a href="#cb8-96" tabindex="-1"></a>Step <span class="dv">4</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Common package duration calculation was not selected <span class="cf">in</span> the parameters; skipping this step.</span>
<span id="cb8-97"><a href="#cb8-97" tabindex="-1"></a>Step <span class="dv">5</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Preparing drug use periods...</span>
<span id="cb8-98"><a href="#cb8-98" tabindex="-1"></a>Step <span class="dv">6</span><span class="sc">/</span><span class="dv">6</span><span class="sc">:</span> Post<span class="sc">-</span>processing drug use periods...</span>
<span id="cb8-99"><a href="#cb8-99" tabindex="-1"></a>Current post processing percentage<span class="sc">:</span> <span class="dv">1</span></span>
<span id="cb8-100"><a href="#cb8-100" tabindex="-1"></a>Drug use periods calculated. <span class="dv">10</span> periods created <span class="cf">for</span> <span class="dv">5</span> persons.</span>
<span id="cb8-101"><a href="#cb8-101" tabindex="-1"></a></span>
<span id="cb8-102"><a href="#cb8-102" tabindex="-1"></a><span class="co"># The final output</span></span>
<span id="cb8-103"><a href="#cb8-103" tabindex="-1"></a>final_periods <span class="ot">&lt;-</span> outdata<span class="sc">$</span>periods</span>
<span id="cb8-104"><a href="#cb8-104" tabindex="-1"></a>final_periods</span>
<span id="cb8-105"><a href="#cb8-105" tabindex="-1"></a>   period     id     atc  dup_start    dup_end dup_days dup_hospital_days dup_n_purchases dup_last_purchase dup_total_DDD dup_temporal_average_DDDs</span>
<span id="cb8-106"><a href="#cb8-106" tabindex="-1"></a>     <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>fctr<span class="sc">&gt;</span>  <span class="er">&lt;</span>char<span class="sc">&gt;</span>     <span class="er">&lt;</span>Date<span class="sc">&gt;</span>     <span class="er">&lt;</span>Date<span class="sc">&gt;</span>    <span class="er">&lt;</span>num<span class="sc">&gt;</span>             <span class="er">&lt;</span>num<span class="sc">&gt;</span>           <span class="er">&lt;</span>int<span class="sc">&gt;</span>            <span class="er">&lt;</span>Date<span class="sc">&gt;</span>         <span class="er">&lt;</span>num<span class="sc">&gt;</span>                     <span class="er">&lt;</span>num<span class="sc">&gt;</span></span>
<span id="cb8-107"><a href="#cb8-107" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>      <span class="dv">1</span>      <span class="dv">1</span> N05AH02 <span class="dv">2020-02-10</span> <span class="dv">2021-03-23</span>      <span class="dv">408</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2021-02-04</span>           <span class="dv">330</span>                     <span class="fl">0.809</span></span>
<span id="cb8-108"><a href="#cb8-108" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>      <span class="dv">2</span>      <span class="dv">1</span> N05AH04 <span class="dv">2022-05-01</span> <span class="dv">2025-09-05</span>     <span class="dv">1224</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2025-04-15</span>           <span class="dv">800</span>                     <span class="fl">0.654</span></span>
<span id="cb8-109"><a href="#cb8-109" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>      <span class="dv">3</span>      <span class="dv">2</span> N05AH02 <span class="dv">2020-02-10</span> <span class="dv">2021-03-23</span>      <span class="dv">408</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2021-02-04</span>           <span class="dv">330</span>                     <span class="fl">0.809</span></span>
<span id="cb8-110"><a href="#cb8-110" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>      <span class="dv">4</span>      <span class="dv">2</span> N05AH04 <span class="dv">2022-05-01</span> <span class="dv">2025-09-05</span>     <span class="dv">1224</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2025-04-15</span>           <span class="dv">800</span>                     <span class="fl">0.654</span></span>
<span id="cb8-111"><a href="#cb8-111" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>      <span class="dv">5</span>      <span class="dv">3</span> N05AH02 <span class="dv">2020-02-10</span> <span class="dv">2021-03-23</span>      <span class="dv">408</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2021-02-04</span>           <span class="dv">330</span>                     <span class="fl">0.809</span></span>
<span id="cb8-112"><a href="#cb8-112" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>      <span class="dv">6</span>      <span class="dv">3</span> N05AH04 <span class="dv">2022-05-01</span> <span class="dv">2025-09-05</span>     <span class="dv">1224</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2025-04-15</span>           <span class="dv">800</span>                     <span class="fl">0.654</span></span>
<span id="cb8-113"><a href="#cb8-113" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span>      <span class="dv">7</span>      <span class="dv">4</span> N05AH02 <span class="dv">2020-02-10</span> <span class="dv">2021-03-23</span>      <span class="dv">408</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2021-02-04</span>           <span class="dv">330</span>                     <span class="fl">0.809</span></span>
<span id="cb8-114"><a href="#cb8-114" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>      <span class="dv">8</span>      <span class="dv">4</span> N05AH04 <span class="dv">2022-05-01</span> <span class="dv">2025-09-05</span>     <span class="dv">1224</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2025-04-15</span>           <span class="dv">800</span>                     <span class="fl">0.654</span></span>
<span id="cb8-115"><a href="#cb8-115" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>      <span class="dv">9</span>      <span class="dv">5</span> N05AH02 <span class="dv">2020-02-10</span> <span class="dv">2021-03-23</span>      <span class="dv">408</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2021-02-04</span>           <span class="dv">330</span>                     <span class="fl">0.809</span></span>
<span id="cb8-116"><a href="#cb8-116" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span>     <span class="dv">10</span>      <span class="dv">5</span> N05AH04 <span class="dv">2022-05-01</span> <span class="dv">2025-09-05</span>     <span class="dv">1224</span>                 <span class="dv">0</span>              <span class="dv">10</span>        <span class="dv">2025-04-15</span>           <span class="dv">800</span>                     <span class="fl">0.654</span></span></code></pre></div>
<p>For any questions or support, feel free to reach out to the package
maintainers</p>
<p>…</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pia Vattulainen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
