<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Validate Drug Purchase Data — check_purchases • PRE2DUPR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validate Drug Purchase Data — check_purchases"><meta name="description" content="This function checks the structure and content of drug purchase data (data.frame or data.table) for use in pre2dup workflows.
It helps users detect errors in advance, such as missing or invalid records, incorrect formats, or dates outside a specified range.
If all checks pass, the function can return a validated data.table with the required columns and proper types."><meta property="og:description" content="This function checks the structure and content of drug purchase data (data.frame or data.table) for use in pre2dup workflows.
It helps users detect errors in advance, such as missing or invalid records, incorrect formats, or dates outside a specified range.
If all checks pass, the function can return a validated data.table with the required columns and proper types."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PRE2DUPR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><a class="dropdown-item" href="../tutorials/Instruction_to_build_package_parameter.html">Package Parameters</a></li>
    <li><a class="dropdown-item" href="../tutorials/introduction_to_ATC_parameter.html">ATC Parameters</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Validate Drug Purchase Data</h1>

      <div class="d-none name"><code>check_purchases.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function checks the structure and content of drug purchase data (data.frame or data.table) for use in <code><a href="pre2dup.html">pre2dup</a></code> workflows.
It helps users detect errors in advance, such as missing or invalid records, incorrect formats, or dates outside a specified range.
If all checks pass, the function can return a validated data.table with the required columns and proper types.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">check_purchases</span><span class="op">(</span></span>
<span>  <span class="va">dt</span>,</span>
<span>  pre_person_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pre_atc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pre_package_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pre_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pre_ratio <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pre_ddd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  date_range <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  print_all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_data <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dt">dt<a class="anchor" aria-label="anchor" href="#arg-dt"></a></dt>
<dd><p>data.frame or data.table containing drug purchase records.</p></dd>


<dt id="arg-pre-person-id">pre_person_id<a class="anchor" aria-label="anchor" href="#arg-pre-person-id"></a></dt>
<dd><p>Character. Column name for the person identifier.</p></dd>


<dt id="arg-pre-atc">pre_atc<a class="anchor" aria-label="anchor" href="#arg-pre-atc"></a></dt>
<dd><p>Character. Column name for the ATC code.</p></dd>


<dt id="arg-pre-package-id">pre_package_id<a class="anchor" aria-label="anchor" href="#arg-pre-package-id"></a></dt>
<dd><p>Character. Column name for the package identifier (e.g., Vnr in Nordic data).</p></dd>


<dt id="arg-pre-date">pre_date<a class="anchor" aria-label="anchor" href="#arg-pre-date"></a></dt>
<dd><p>Character. Column name for the drug purchase date.</p></dd>


<dt id="arg-pre-ratio">pre_ratio<a class="anchor" aria-label="anchor" href="#arg-pre-ratio"></a></dt>
<dd><p>Character. Column name for the amount of drug purchased: for whole packages, number of packages; for partial supplies, the proportion of a package (e.g., 0.5 for 14 tablets from a 28-tablet package).</p></dd>


<dt id="arg-pre-ddd">pre_ddd<a class="anchor" aria-label="anchor" href="#arg-pre-ddd"></a></dt>
<dd><p>Character. Column name for defined daily dose (DDD) of the purchase.</p></dd>


<dt id="arg-date-range">date_range<a class="anchor" aria-label="anchor" href="#arg-date-range"></a></dt>
<dd><p>Character vector of length 2. Date range for purchase dates (e.g., c("1995-01-01", "2018-12-31")). Default is NULL (no date range check).</p></dd>


<dt id="arg-print-all">print_all<a class="anchor" aria-label="anchor" href="#arg-print-all"></a></dt>
<dd><p>Logical. If TRUE, all row numbers that caused warnings are printed; if FALSE, only the first 5 problematic rows are printed.</p></dd>


<dt id="arg-return-data">return_data<a class="anchor" aria-label="anchor" href="#arg-return-data"></a></dt>
<dd><p>Logical. If TRUE and no errors are detected, returns a data.table with the validated columns and proper types. If FALSE, only a message is printed.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>return_data = TRUE</code>, returns a data.table containing only the validated columns, with converted types.
If errors are detected, the function stops and prints error messages.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The following checks are performed:</p><ul><li><p>Existence and naming of required columns</p></li>
<li><p>No missing or duplicated records</p></li>
<li><p>Each package has a unique ATC code</p></li>
<li><p>Validity of person identifiers (numeric or non-numeric, no missing values)</p></li>
<li><p>Validity of ATC codes (no missing or invalid values)</p></li>
<li><p>Validity of package IDs and purchase ratio (numeric, no missing values)</p></li>
<li><p>DDD values: missing allowed, but not zero or negative</p></li>
<li><p>All purchase dates must be present, convertible, and within the specified range (if given)</p></li>
<li><p>Sufficient DDD coverage per ATC (with user confirmation if below threshold)</p></li>
</ul><p>If any errors are found, the function stops execution and prints all error messages.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100001</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100002</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ATC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"N06AX11"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"N05AH03"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vnr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">48580</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">145698</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1998-07-04"</span>,<span class="st">"1998-07-27"</span>,<span class="st">"1998-08-28"</span>, <span class="st">"2000-01-12"</span>, <span class="st">"2000-02-05"</span>,<span class="st">"2000-02-24"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ddds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">28</span>, <span class="fl">14</span>, <span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">purchases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">ATC</span>, <span class="va">vnr</span>, <span class="va">dates</span>, <span class="va">ratios</span>, <span class="va">ddds</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">check_purchases</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dt <span class="op">=</span> <span class="va">purchases</span>,</span></span>
<span class="r-in"><span>  pre_person_id <span class="op">=</span> <span class="st">"ID"</span>,</span></span>
<span class="r-in"><span>  pre_atc <span class="op">=</span> <span class="st">"ATC"</span>,</span></span>
<span class="r-in"><span>  pre_package_id <span class="op">=</span> <span class="st">"vnr"</span>,</span></span>
<span class="r-in"><span>  pre_date <span class="op">=</span> <span class="st">"dates"</span>,</span></span>
<span class="r-in"><span>  pre_ratio <span class="op">=</span> <span class="st">"ratios"</span>,</span></span>
<span class="r-in"><span>  pre_ddd <span class="op">=</span> <span class="st">"ddds"</span>,</span></span>
<span class="r-in"><span>  date_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1995-01-01"</span>, <span class="st">"2018-12-31"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  print_all <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  return_data <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checks passed for 'purchases'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        ID     ATC    vnr      dates ratios  ddds date_pre</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;fctr&gt;  &lt;char&gt;  &lt;int&gt;     &lt;Date&gt;  &lt;num&gt; &lt;num&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: 100001 N06AX11  48580 1998-07-04    0.5   7.5    10411</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: 100001 N06AX11  48580 1998-07-27    2.0  30.0    10434</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: 100001 N06AX11  48580 1998-08-28    2.0  30.0    10466</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4: 100002 N05AH03 145698 2000-01-12    1.0  28.0    10968</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5: 100002 N05AH03 145698 2000-02-05    0.5  14.0    10992</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6: 100002 N05AH03 145698 2000-02-24    2.0  56.0    11011</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pia Vattulainen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

